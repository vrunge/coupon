---
title: "Simulation of coupon collector's problem"
author: "Kachaikin Marko"
date: "`r Sys.Date()`"
output: html_document
---

## Choice of number of coupons and probabilites 
```{r}

#Suppose we have 5 types of coupons
n <- 5
# Let's generate probabilites 
prob <- runif(n = n, min = 0, max = 1)
prob <- prob/sum(prob)
prob
barplot(prob)
```

## Initial problem
In this part of work, we simulate an initial coupon collector's problem

```{r}

numb_of_coupons<-0
coupons<-c()
collection<-c()
full_collection<-1:n
while(length(collection)!=length(full_collection)){
  a<-sample(1:n,size = 1, replace = TRUE, prob = prob)
  collection<-c(collection,a)
  coupons<-c(coupons,a)
  collection<-collection[!duplicated(collection)]
  numb_of_coupons<-numb_of_coupons+1
}

coupons # All coupons that we obtained
numb_of_coupons # Number of coupons that we need to complete full collection 
collection # In which order collector obtain unique type of coupons 
```

## Geometrical distribution approach 
```{r}
nb <- 1000 #nb of repetitions
res <- replicate(nb, max(rgeom(n, prob)))
mean(res)
var(res)
hist(res, breaks = 50)

# theoretical result

integrand <- function(x) {1- prod(1-exp(-prob*x))}
theor_m<-integrate(Vectorize(integrand), lower = 0, upper = Inf)
theor_m<-theor_m$value
integrand_vr<- function(x){1- prod(1-exp(-prob*sqrt(x)))}
theor_sec_m<-integrate(Vectorize(integrand_vr), lower = 0, upper = Inf)
theor_vr<- theor_sec_m$value-theor_m-(theor_m)^2
rel_er_mean<- abs(theor_m-mean(res))/mean(res)
rel_er_var<- abs(theor_vr-var(res))/var(res)

# Comparing results

sprintf("Empirical mean: %f, Theoretical mean: %f, Relative measurement error for mean: %f",mean(res),theor_m,rel_er_mean)

sprintf("Empirical variance: %f, Theoretical variance: %f, Relative measurement error for variance: %f",var(res),theor_vr,rel_er_var)
```

## Exponential distribution approach
```{r}
result <- replicate(nb, max(rexp(n,prob)))

hist(result)
emp_m<- mean(result)
emp_vr<-var(result)

#theoretical result
integrand <- function(x) {1- prod(1-exp(-prob*x))}
theor_m<-integrate(Vectorize(integrand), lower = 0, upper = Inf)
theor_m <- theor_m$value

integrand_vr<- function(x){1- prod(1-exp(-prob*sqrt(x)))}
theor_sec_m<-integrate(Vectorize(integrand_vr), lower = 0, upper = Inf)
theor_vr<-theor_sec_m$value - (theor_m)^2

rel_er_mean<- abs(theor_m-emp_m)/emp_m
rel_er_var<- abs(theor_vr-emp_vr)/emp_vr
# Comparing results

sprintf("Empirical mean: %f, Theoretical mean: %f, Relative measurement error for mean: %f",emp_m,theor_m,rel_er_mean)

sprintf("Empirical variance: %f, Theoretical variance: %f, Relative measurement error for variance: %f",emp_vr,theor_vr,rel_er_var)
```